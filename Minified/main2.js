class AudioManager{constructor(){this.context=new(window.AudioContext||window.webkitAudioContext);this.t=this.context.createGain();this.t.connect(this.context.destination);this.i={1:"a b n b o b c",2:"a".repeat(4),3:"za",4:"o"}}o(t,e=false,s=.15,a=1){this.play(this.i[t],e,s,a)}play(a,i=false,n,r=1){const c=t=>{if(t>=a.length){if(i)setTimeout(()=>c(0),n*950);if(n>.09)n-=.005;return}const e=this.context.createOscillator();const s=this.context.createGain();e.type="square";e.connect(s);s.connect(this.t);e.frequency.setValueAtTime(220+a.charCodeAt(t)%88*10,this.context.currentTime);s.gain.setValueAtTime(0,this.context.currentTime);s.gain.linearRampToValueAtTime(r,this.context.currentTime+.05);s.gain.exponentialRampToValueAtTime(.001,this.context.currentTime+n);e.start();e.stop(this.context.currentTime+n);e.onended=()=>{setTimeout(()=>c(t+1),n*1e3)}};c(0)}}function drawRectangle(t,e,s,a,i,n="black"){t.fillStyle=n;t.fillRect(e,s,a,i)}function drawCircle(t,e,s,a,i="black"){t.beginPath();t.arc(e,s,a,0,2*Math.PI);t.fillStyle=i;t.fill()}function drawLightning(t,e,s,a,i,n=6,r=50){if(n===0)return;t.strokeStyle="white";t.lineWidth=2;t.beginPath();t.moveTo(e,s);t.lineTo((e+a)/2+(Math.random()*r-r/2),(s+i)/2+(Math.random()*r-r/2));t.lineTo(a,i);t.stroke();drawLightning(t,e,s,(e+a)/2+(Math.random()*r-r/2),(s+i)/2+(Math.random()*r-r/2),n-1,r/1.5);drawLightning(t,(e+a)/2+(Math.random()*r-r/2),(s+i)/2+(Math.random()*r-r/2),a,i,n-1,r/1.5)}const healthColor=(t,e)=>`#${Math.floor(255*(e/t)).toString(16).padStart(2,"0").repeat(3)}`;class Compressor{constructor(t,e){this.matrix=t;this.h=e;this.l=t.length}g(e=.25,t=false){const n=this.u(this.h);const r=this.l/this.h;for(let t=0;t<this.h;t++){for(let i=0;i<this.h;i++){let s=0,a=0;for(let e=Math.floor(t*r);e<Math.floor((t+1)*r);e++){for(let t=Math.floor(i*r);t<Math.floor((i+1)*r);t++){if(e<this.l&&t<this.l){s+=this.matrix[e][t];a++}}}const c=s/a;n[t][i]=c>e?1:0}}if(t){return this.p(n)}return n}p(a){const i={0:["0000000000000000","0005911111180000","0591111111111000","0711115491111100","2911520000911140","7111000000071190","7112000000008190","7112000000008190","7112000000008190","7112000000001190","7911000000021190","5811140000411190","0781115445111100","0088881111111500","0005555888855000","0000055555500000"],13:["0000000000000000","0000000000000000","0111199997777760","0111111111111192","0333333333333322","0000000000000000","0099900000055500","0999900000069820","0911900000079820","0911006982279820","0911227997229770","0911111111119770","0711111111111870","0057888377765500","0000000000000000","0000000000000000"]};let n={};let r=null;let c=0;Object.keys(i).forEach(t=>{const e=compareMatrices(a,applyReverseMappingToMatrix(convertTemplateToMatrix(i[t])));n[t]=e;console.log(`Similarity with template ${t}: ${e}%`);if(e>50){const s=(e-50)*100/50;console.log(`Similarity altered = ${s}%`);if(s>c){c=s;r=t}}});console.log("Topmost similarity key:",r);document.getElementById("i2").innerHTML="Top Prediction : "+r+"<br>Accuracy :"+c;return r}u(t){return Array(t).fill(null).map(()=>Array(t).fill(0))}}function convertTemplateToMatrix(t){return t.map(t=>t.split("").map(Number))}function applyReverseMappingToMatrix(t){return t.map(t=>t.map(reverseMapToAverage))}function reverseMapToAverage(t){return t===1?1:t>=0&&t<=9?t/10:0}function compareMatrices(s,a){let i=0;let n=0;let r=0;const c=.5;for(let e=0;e<16;e++){for(let t=0;t<16;t++){if(a[e][t]>c){n++;if(s[e][t]===1){i++}else{i-=1.5}}else if(a[e][t]>=c-.2&&s[e][t]===1){i+=.3}if(s[e][t]===1){r++}}}return(Math.max(0,i*n/Math.max(r,1))/n*100).toFixed(2)}class Sprite{constructor(t,e,s,a,i=1,n=0,r=1,c=150,o=25){this.x=t;this.y=e;this.m=s;this.v=a;this.scale=i;this.M=n;this.S=r;this.C=c;this.P={x:0,y:0};this.T=0;this.A=o}vibrate(){if(Date.now()-this.T>=this.C){this.P={x:(Math.random()-.25)*this.S,y:(Math.random()-.25)*this.S};this.T=Date.now()}}moveTo(t,e){this.y+=e;this.x+=t}R(){this.vibrate();this.v.save();this.v.translate(this.x+this.P.x+this.m.width*this.scale/2,this.y+this.P.y+this.m.height*this.scale/2);this.v.rotate(this.M);this.v.drawImage(this.m,-this.m.width*this.scale/2,-this.m.height*this.scale/2,this.m.width*this.scale,this.m.height*this.scale);this.v.restore()}}class EnemySprite extends Sprite{constructor(t,e,s,a,i=1,n=0,r=1,c=150,o="rectangle",h){super(t,e,s,a,i,n,r,c);this.shape=o;this.A=h;this.k=10}vibrate(){super.vibrate()}moveTo(t,e){super.moveTo(t,e)}R(){this.vibrate();this.v.save();this.v.translate(this.x+this.P.x,this.y+this.P.y);this.shape==="rectangle"?drawRectangle(this.v,-50,-50,12*this.scale,12*this.scale):drawCircle(this.v,0,0,12*this.scale);this.shape==="rectangle"?drawRectangle(this.v,-50,-50,11*this.scale,11*this.scale,healthColor(this.k,this.A)):drawCircle(this.v,0,0,11*this.scale,healthColor(this.k,this.A));this.v.restore()}}class Particle{constructor(t,e,s,a,i){this.x=t+(Math.random()-.5)*100;this.y=e+(Math.random()-.5)*100;this.v=s;this.L=a*Math.cos(i);this.B=a*Math.sin(i);this.color="red";this.size=5;this.D=3e3;this.creationTime=Date.now()}R(){const t=(Date.now()-this.creationTime)/this.D;if(t>=1)return false;this.x+=this.L;this.y+=this.B;this.v.globalAlpha=1-t;this.v.fillStyle=this.color;this.v.fillRect(this.x,this.y,this.size,this.size);return true}}const audioManager=new AudioManager;const gamecanvas=document.getElementById("g");const gcanvas=gamecanvas.getContext("2d");gcanvas.canvas.height=256;gcanvas.canvas.width=gcanvas.canvas.height*2;let topKey=false;let maxHealth=50;const color_C3C7CB="#C3C7CB";let score=0;let particles=[];const canvas1=document.getElementById("d");const ctx1=canvas1.getContext("2d");const size=256;const brushSize=30;canvas1.width=size;canvas1.height=size;let matrix=Array(size).fill(null).map(()=>Array(size).fill(0));let painting=false;canvas1.addEventListener("mousedown",()=>painting=true);canvas1.addEventListener("mouseup",()=>painting=false);canvas1.addEventListener("mousemove",draw);const Player=new Image;Player.src="./public/compressed2.png";const Sword=new Image;Sword.src="./public/compresseds1.png";let Psprite,Ssprite;Sword.onload=()=>{Psprite=new Sprite(50,180,Player,gcanvas,.5);Ssprite=new Sprite(85,180,Sword,gcanvas,1,Math.PI/1.6)};function drawStartScreen(){const[t,e,s,a]=[190,100,120,50];drawRectangle(gcanvas,0,0,512,256,"white");gcanvas.fillStyle=color_C3C7CB;gcanvas.fillRect(t,e,s,a);gcanvas.fillStyle="#FFF";gcanvas.fillRect(t,e,s,2);gcanvas.fillRect(t,e,2,a);gcanvas.fillStyle="#000";gcanvas.fillRect(t+s-2,e,2,a);gcanvas.fillRect(t,e+a-2,s,2);gcanvas.font="16px Arial";gcanvas.textAlign="center";gcanvas.fillStyle="#000";gcanvas.fillText("Play",t+s/2,e+a/2+5);DrawBorder(color_C3C7CB)}function DrawBorder(e){for(let t of[[0,gcanvas.canvas.height-30,gcanvas.canvas.width,50,e],[0,-20,gcanvas.canvas.width,50,e],[0,0,20,gcanvas.canvas.height,e],[gcanvas.canvas.width-20,0,20,gcanvas.canvas.height,e]])drawRectangle(gcanvas,...t)}function ResetPos(){Psprite.y=180;Ssprite.y=Psprite.y}function startGameLoop(){if(Psprite.A<=0){location.reload();return}gcanvas.save();gcanvas.clearRect(0,0,gcanvas.canvas.width,gcanvas.canvas.height);drawRectangle(gcanvas,0,0,512,256,healthColor(maxHealth,Psprite.A));drawEnemies(gcanvas);Psprite.R();Ssprite.R();if(topKey=="13"){audioManager.o("2",false,.05);Ssprite.y=128;Psprite.y=-999;drawLightning(gcanvas,Ssprite.x+45,Ssprite.y+10,Math.random()*gcanvas.canvas.width,Math.random()*gcanvas.canvas.width)}else{ResetPos()}particles=particles.filter(t=>t.R());gcanvas.restore();DrawBorder(color_C3C7CB)}function gameLoop(){startGameLoop();requestAnimationFrame(gameLoop)}let Sinterval=5e3;function onClick(){audioManager.o("1",true,.2,.025);gameLoop();setInterval(spawnEnemy,Sinterval);Sinterval-=20;gamecanvas.removeEventListener("click",onClick)}gamecanvas.addEventListener("click",onClick);function draw(t){if(!painting)return;const e=canvas1.getBoundingClientRect();ctx1.beginPath();ctx1.arc(t.clientX-e.left,t.clientY-e.top,brushSize/2,0,Math.PI*2);ctx1.fillStyle="black";ctx1.fill();const s=Math.floor(t.clientX-e.left);const a=Math.floor(t.clientY-e.top);for(let e=s-brushSize/2;e<s+brushSize/2;e++){for(let t=a-brushSize/2;t<a+brushSize/2;t++){if(e>=0&&e<size&&t>=0&&t<size){matrix[e][t]=1}}}}document.getElementById("s").addEventListener("click",async()=>{ctx1.clearRect(0,0,canvas1.width,canvas1.height);let e=matrix;[128,64,32,16].forEach(t=>{e=new Compressor(e,t).g(.1)});topKey=await new Compressor(e,16).g(.1,true);if(topKey==="13"&&enemies.length!=0){score+=3;matrix=Array(size).fill(null).map(()=>Array(size).fill(0));enemies.forEach(t=>{t.A-=5});setTimeout(()=>{topKey=false},1e3);return}else if(topKey==="0"&&enemies.length!=0){removeClosestEnemy();matrix=Array(size).fill(null).map(()=>Array(size).fill(0));score+=1;return}else{score-=1;RemovePhealth(1)}ScoreManager();audioManager.o("3",false,.3)});function removeClosestEnemy(){let a=null;let i=Infinity;enemies.forEach((t,e)=>{let s=Math.abs(t.x-Psprite.x);if(s<i){i=s;a=e}});if(a!==null){let t=enemies[a];enemies.splice(a,1);score+=1;ScoreManager(Psprite.A);var e=30;while(e){particles.push(new Particle(t.x,t.y,gcanvas,2,Math.random()*Math.PI*2));e--}}}let enemies=[];const enemySpeed=.25;function spawnEnemy(){const t=Math.random()<.5?85:215;const e=t===85?"rectangle":"circle";const s=new EnemySprite(512,t,null,gcanvas,1,0,1,150,e,10);enemies.push(s)}function drawEnemies(){enemies.forEach((t,e)=>{t.moveTo(-enemySpeed,0);t.R();if(t.y<0){enemies.splice(e,1);RemovePhealth(1)}if(t.A<=0){enemies.splice(e,1);score+=1;ScoreManager();var s=10;while(s){particles.push(new Particle(t.x,t.y,gcanvas,2,Math.random()*Math.PI*2));s--}}})}function ScoreManager(){document.getElementById("i1").innerHTML=" Score : "+score}ScoreManager();function RemovePhealth(t){Psprite.A-=t}drawStartScreen();